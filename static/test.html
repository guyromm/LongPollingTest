<!doctype html>
<html>
<head>
<script type='text/javascript' src='/static/zepto.js'></script>
</head>
<body>
<a href="javascript:addrandom()">add random contents</a> ::
<a href="javascript:stop()">stop incrementor</a> :: 
     <a href="javascript:startincrementor()">resume incrementor</a> ::
     <span id='tokval'></span>
<div id='contents'></div>
<script type='text/javascript'>
var tok = null;
var makelp = function(cb) {
     $.getJSON('/lp/'+tok,
	       function(rt) {
		   //console.log(rt);
		   cb(rt);
		   makelp(cb);
	       });
 };
function addrandom() {
    $.getJSON('/lp/'+tok+'/putaction?pkg='+encodeURIComponent(JSON.stringify({'c':Math.random()+' from '+new Date()})));
}
function stop() {
    $.getJSON('/lp/'+tok+'/stop');
}
function startincrementor() {
    $.getJSON('/lp/'+tok+'/startincrementor');
}

$(function() {
	tok = decodeURIComponent(/tok=(.*)/.exec(location.href)[1]);
	if (!tok) tok='abcde';
	$('#tokval').text(tok);
	makelp(function(dt) { 
		var nel = $('<div />').text(JSON.stringify(dt));
		//nel.prependTo($('#contents'));
		$('#contents').prepend(nel); 
	    });
});
</script>
</body>
</html>
